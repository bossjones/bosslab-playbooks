apiVersion: apps/v1beta1
kind: Deployment
metadata:
  name: kibana-logging
  namespace: {{boss__efk__namespace_name}}
{%   if boss__efk__kibana_deployment_labels is defined %}
  labels:
    {{ boss__efk__kibana_deployment_labels | to_nice_yaml(indent=2) }}
{%   endif %}
spec:
  replicas: {{boss__efk__kibana_deployment_spec_replicas}}
  selector:
{%   if boss__efk__kibana_deployment_spec_selector_match_labels is defined %}
    matchLabels:
      {{ boss__efk__kibana_deployment_spec_selector_match_labels | to_nice_yaml(indent=2) }}
{%   endif %}
  template:
    metadata:
{%   if boss__efk__kibana_deployment_spec_template_metadata_labels is defined %}
      labels:
        {{ boss__efk__kibana_deployment_spec_template_metadata_labels | to_nice_yaml(indent=2) }}
{%   endif %}
    spec:
{%   if boss__efk__kibana_deployment_spec_template_spec_node_selector is defined %}
      nodeSelector:
        {{ boss__efk__kibana_deployment_spec_template_spec_node_selector | to_nice_yaml(indent=2) }}
{%   endif %}
      # SOURCE: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/
      containers:
      - name: kibana-logging
        imagePullPolicy: Always
        # image: docker.elastic.co/kibana/kibana:5.6.2
        image: {{boss__efk__kibana_image_repo}}:{{boss__efk__kibana_image_tag}}
        resources:
          # need more cpu upon initialization, therefore burstable class
          limits:
            cpu: {{boss__efk__kibana_cpu_limit}}
          requests:
            cpu: {{boss__efk__kibana_cpu_requests}}
        env:
          - name: ELASTICSEARCH_URL
            value: http://elasticsearch-logging:9200
          # - name: SERVER_BASEPATH
          #   value: /api/v1/proxy/namespaces/kube-system/services/kibana-logging
          - name: XPACK_MONITORING_ENABLED
            value: "false"
          - name: XPACK_SECURITY_ENABLED
            value: "false"
        ports:
        - containerPort: 5601
          name: ui
          protocol: TCP
